<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="paper_format_attendance_report" model="report.paperformat">
        <field name="name">Attendance Report</field>
        <field name="default" eval="True"/>
        <field name="format">A4</field>
        <field name="page_height">0</field>
        <field name="page_width">0</field>
        <field name="orientation">Landscape</field>
        <field name="margin_top">30</field>
        <field name="margin_bottom">5</field>
        <field name="margin_left">7</field>
        <field name="margin_right">7</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">25</field>
        <field name="dpi">90</field>
    </record>


    <record id="report_attendance_pdf" model="ir.actions.report">
        <field name="name">Attendance PDF Report</field>
        <field name="model">hr.attendance</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">hr_payroll_extended.attendance_report_template</field>
        <field name="report_file">hr_payroll_extended.attendance_report_template</field>
        <field name="paperformat_id" ref="hr_payroll_extended.paper_format_attendance_report"/>
    </record>

    <!--FOR HEADER-->
    <template id="attendance_report_template_header">
        <div class="header">
            <div class="row">
                <div align="right" width="50%">
                    <img src="/web/binary/company_logo"
                         class="img-responsive"/>
                </div>
            </div>
        </div>
    </template>

    <template id="attendance_report_template">
        <t t-if="data['report_all_attendance_report'] or data['report_all_present_absent']">
            <t t-if="data['report_all_attendance_report']">
                <t t-call="hr_payroll_extended.attendance_report_for_employee_present_full_details"/>
            </t>
            <t t-if="data['report_all_present_absent']">
                <t t-call="hr_payroll_extended.attendance_report_for_present_absent"/>
            </t>
        </t>
        <t t-else="">
            <t t-call="hr_payroll_extended.attendance_report_for_employee_present_full_details"/>
            <t t-call="hr_payroll_extended.attendance_report_for_present_absent"/>
        </t>
    </template>


    <template id="attendance_report_for_employee_present_full_details">
        <t t-call="web.html_container">
            <t t-call="web.basic_layout">
                <t t-call="hr_payroll_extended.attendance_report_template_header"/>
                <div class="page">
                    <table class="table table-sm table-bordered">
                        <tr style="font-size: 14px; color: white; background-color: #989898;"
                            class="padding_all tleft tbottom ttop text-center">
                            <td colspan="2">
                                <h3 align="center">Attendance Report</h3>
                            </td>
                        </tr>
                    </table>
                    <div class="row">
                        <div class="col-6">
                            <span style="font-size: 16px;">
                                <b>Generated By</b>
                            </span>
                            <strong class="px-2">:</strong>
                            <span t-field="res_company.env.user.name"/>
                        </div>
                        <div class="col-6">
                            <span style="font-size: 16px;">
                                <b>Generated On</b>
                            </span>
                            <strong class="px-2">:</strong>
                            <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%d-%m-%Y %H:%M')"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <span style="font-size: 16px;">
                                <b>Start Date</b>
                            </span>
                            <strong class="px-2">:</strong>
                            <span t-esc="start_date"/>
                        </div>
                        <div class="col-6">
                            <span style="font-size: 16px;">
                                <b>End Date</b>
                            </span>
                            <strong class="px-2">:</strong>
                            <span t-esc="end_date"/>
                        </div>
                    </div>
                    <br/>
                    <div class="page">
                        <table class="table table-sm table-bordered">
                            <tr
                                    style="font-size: 14px; color: white; background-color: #989898;"
                                    class="padding_all tleft tbottom ttop text-center">
                                <td colspan="2">
                                    <h5 align="center">Employee Present List</h5>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <table class="table table-sm table-bordered">
                        <thead style="color: white; background-color: #989898; text-align: center;">
                            <t t-foreach="cols_heads" t-as="head">
                                <th>
                                    <span t-esc="head"/>
                                </th>
                            </t>
                        </thead>
                        <tbody>
                            <t t-set="val_true_false" t-value="False"/>
                            <t t-set="date_val" t-value="111"/>
                            <t t-foreach="attendance_details_read" t-as="d">
                                <t t-if="val_true_false == False">
                                    <t t-set="val_true_false" t-value="True"/>
                                    <t t-set="date_val" t-value="d['check_in'].strftime('%d-%m-%Y')"/>
                                    <tr>
                                        <td colspan="7"/>
                                    </tr>
                                    <tr>
                                        <td style="color: white; background-color: #989898; text-align: center;"
                                            colspan="7">
                                            <span t-esc="d['check_in'].strftime('%d-%m-%Y')"/>
                                        </td>
                                    </tr>
                                </t>
                                <t t-if="d['check_in'].strftime('%d-%m-%Y') == date_val">
                                    <tr>
                                        <td>
                                            <span t-esc="d_index+1"/>
                                        </td>
                                        <td>
                                            <span t-esc="d['employee_id'][1]"/>
                                        </td>
                                        <t t-if="d['check_in']">
                                            <td>
                                                <span t-esc="d['check_in'].strftime('%d-%m-%Y')"/>
                                            </td>
                                            <td>
                                                <span t-esc="d['check_in'].astimezone(local_timezone).strftime('%I:%M %p')"/>
                                            </td>
                                        </t>
                                        <t t-else="">
                                            <td align="center">
                                                -
                                            </td>
                                            <td align="center">
                                                -
                                            </td>
                                        </t>
                                        <t t-if="d['check_out']">
                                            <td>
                                                <span t-esc="d['check_out'].strftime('%d-%m-%Y')"/>
                                            </td>
                                            <td>
                                                <span t-esc="d['check_out'].astimezone(local_timezone).strftime('%I:%M %p')"/>
                                            </td>
                                        </t>
                                        <t t-else="">
                                            <td align="center">
                                                -
                                            </td>
                                            <td align="center">
                                                -
                                            </td>
                                        </t>
                                        <t t-if="d['worked_hours']">
                                            <td>
                                                <span t-esc="str(int(d['worked_hours'])) + ' Hours ' + str(int((d['worked_hours'] - int(d['worked_hours'])) * 60)) + ' Mins'"/>
                                            </td>
                                        </t>
                                        <t t-else="">
                                            <td align="center">
                                                -
                                            </td>
                                        </t>
                                    </tr>
                                </t>
                                <t t-if="d['check_in'].strftime('%d-%m-%Y') != date_val">
                                    <t t-set="val_true_false" t-value="True"/>
                                    <t t-set="date_val" t-value="d['check_in'].strftime('%d-%m-%Y')"/>
                                    <tr>
                                        <td colspan="7"/>
                                    </tr>
                                    <tr>
                                        <td style="color: white; background-color: #989898; text-align: center;"
                                            colspan="7">
                                            <span t-esc="d['check_in'].strftime('%d-%m-%Y')"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="7"/>
                                    </tr>
                                    <tr>
                                        <td>
                                            <span t-esc="d_index+1"/>
                                        </td>
                                        <td>
                                            <span t-esc="d['employee_id'][1]"/>
                                        </td>
                                        <t t-if="d['check_in']">
                                            <td>
                                                <span t-esc="d['check_in'].strftime('%d-%m-%Y')"/>
                                            </td>
                                            <td>
                                                <span t-esc="d['check_in'].astimezone(local_timezone).strftime('%I:%M %p')"/>
                                            </td>
                                        </t>
                                        <t t-else="">
                                            <td align="center">
                                                -
                                            </td>
                                            <td align="center">
                                                -
                                            </td>
                                        </t>
                                        <t t-if="d['check_out']">
                                            <td>
                                                <span t-esc="d['check_out'].strftime('%d-%m-%Y')"/>
                                            </td>
                                            <td>
                                                <span t-esc="d['check_out'].astimezone(local_timezone).strftime('%I:%M %p')"/>
                                            </td>
                                        </t>
                                        <t t-else="">
                                            <td align="center">
                                                -
                                            </td>
                                            <td align="center">
                                                -
                                            </td>
                                        </t>
                                        <t t-if="d['worked_hours']">
                                            <td>
                                                <span t-esc="str(int(d['worked_hours'])) + ' Hours ' + str(int((d['worked_hours'] - int(d['worked_hours'])) * 60)) + ' Mins'"/>
                                            </td>
                                        </t>
                                        <t t-else="">
                                            <td align="center">
                                                -
                                            </td>
                                        </t>
                                    </tr>
                                </t>
                            </t>
                        </tbody>
                    </table>

                    <br/>
                    <br/>
                    <div align="center" class="px-3">
                        <h7 style="color: black; text-align:center; font-weight: bold; letter-spacing: 1px; ">
                            ******This is a Computer Generated Attendance Report. Signature Not Required******
                        </h7>
                    </div>

                </div>
            </t>
        </t>
    </template>

    <template id="attendance_report_for_present_absent">
        <t t-call="web.html_container">
            <t t-call="web.basic_layout">
                <t t-call="hr_payroll_extended.attendance_report_template_header"/>
                <div class="page">
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr style="font-size: 14px; color: white; background-color: #989898;"
                                class="padding_all tleft tbottom ttop text-center">
                                <td colspan="2">
                                    <h3 align="center">Attendance Report</h3>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="row">
                        <div class="col-6">
                            <span style="font-size: 16px;">
                                <b>Generated By</b>
                            </span>
                            <strong class="px-2">:</strong>
                            <span t-field="res_company.env.user.name"/>
                        </div>
                        <div class="col-6">
                            <span style="font-size: 16px;">
                                <b>Generated On</b>
                            </span>
                            <strong class="px-2">:</strong>
                            <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%d-%m-%Y %H:%M')"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <span style="font-size: 16px;">
                                <b>Start Date</b>
                            </span>
                            <strong class="px-2">:</strong>
                            <span t-esc="start_date"/>
                        </div>
                        <div class="col-6">
                            <span style="font-size: 16px;">
                                <b>End Date</b>
                            </span>
                            <strong class="px-2">:</strong>
                            <span t-esc="end_date"/>
                        </div>
                    </div>
                    <br/>
                    <table class="table table-sm table-bordered">
                        <tr style="font-size: 14px; color: white; background-color: #989898;"
                            class="padding_all tleft tbottom ttop text-center">
                            <td colspan="2">
                                <h5 align="center">Employee Present And Absent List</h5>
                            </td>
                        </tr>
                    </table>
                </div>

                <t t-foreach="list_month_val" t-as="lmv">
                    <table class="table table-sm table-bordered">
<!--                        <tr align="center"-->
<!--                            style="font-size: 14px; color: white; background-color: #989898;">-->
<!--                            <td colspan="99">-->
<!--                                <span t-esc="lmv"/>-->
<!--                            </td>-->
<!--                        </tr>-->

                        <!--                        <t t-foreach="present_absent" t-as="val">-->
                        <!--                            <t t-foreach="val['list_month_dic']" t-as="month">-->
                        <!--                                <t t-if="month == lmv">-->
                        <!--                                    <div style="page-break-inside: avoid;">-->
                        <!--                                        <tr align="center">-->
                        <!--                                            <td>-->
                        <!--                                                <span t-esc="val['employee_name']"/>-->
                        <!--                                            </td>-->
                        <!--                                            <t t-foreach="val['list_month_dic'][month]['val']" t-as="jj">-->
                        <!--                                                <td>-->
                        <!--                                                    <span t-esc="val['list_month_dic'][month]['val'][jj]['date']"/>-->
                        <!--                                                </td>-->
                        <!--                                            </t>-->
                        <!--                                        </tr>-->
                        <!--                                        <tr align="center">-->
                        <!--                                            <td>-->
                        <!--                                                <span></span>-->
                        <!--                                            </td>-->
                        <!--                                            <t t-foreach="val['list_month_dic'][month]['val']" t-as="jj">-->
                        <!--                                                <t t-if="val['list_month_dic'][month]['val'][jj]['week_day'] != 6">-->
                        <!--                                                    <t t-if="val['list_month_dic'][month]['val'][jj]['val']">-->
                        <!--                                                        <t t-if="val['list_month_dic'][month]['val'][jj]['public_holidays'] == False">-->
                        <!--                                                            <t t-if="val['list_month_dic'][month]['val'][jj]['half'] == False">-->
                        <!--                                                                <t t-if="val['list_month_dic'][month]['val'][jj]['val'] == 'P'">-->
                        <!--                                                                    <td style="background-color: #80ff80">-->
                        <!--                                                                        <span t-esc="val['list_month_dic'][month]['val'][jj]['val']"/>-->
                        <!--                                                                    </td>-->
                        <!--                                                                </t>-->
                        <!--                                                                <t t-else="">-->
                        <!--                                                                    <td style="background-color: #99ccff">-->
                        <!--                                                                        <span t-esc="val['list_month_dic'][month]['val'][jj]['val']"/>-->
                        <!--                                                                    </td>-->
                        <!--                                                                </t>-->
                        <!--                                                            </t>-->
                        <!--                                                            <t t-else="">-->
                        <!--                                                                <td style="background-color: #ffb366">-->
                        <!--                                                                    <span t-esc="val['list_month_dic'][month]['val'][jj]['val']"/>-->
                        <!--                                                                    <br/>-->
                        <!--                                                                    <span style="font-size: 10px"-->
                        <!--                                                                          t-esc="val['list_month_dic'][month]['val'][jj]['half']"/>-->
                        <!--                                                                </td>-->
                        <!--                                                            </t>-->
                        <!--                                                        </t>-->
                        <!--                                                        <t t-else="">-->
                        <!--                                                            <td style="background-color: #ffff80">-->
                        <!--                                                                <span>PH</span>-->
                        <!--                                                            </td>-->
                        <!--                                                        </t>-->
                        <!--                                                    </t>-->
                        <!--                                                    <t t-else="">-->
                        <!--                                                        <t t-if="val['list_month_dic'][month]['val'][jj]['public_holidays'] == True">-->
                        <!--                                                            <td style="background-color: #ffff80">-->
                        <!--                                                                <span>PH</span>-->
                        <!--                                                            </td>-->
                        <!--                                                        </t>-->
                        <!--                                                        <t t-else="">-->
                        <!--                                                            <td>-->
                        <!--                                                                <span>-</span>-->
                        <!--                                                            </td>-->
                        <!--                                                        </t>-->

                        <!--                                                    </t>-->
                        <!--                                                </t>-->
                        <!--                                                <t t-else="">-->
                        <!--                                                    <td style="background-color: #ff704d">-->
                        <!--                                                        <span>H</span>-->
                        <!--                                                    </td>-->
                        <!--                                                </t>-->
                        <!--                                            </t>-->
                        <!--                                        </tr>-->
                        <!--                                    </div>-->
                        <!--                                </t>-->
                        <!--                            </t>-->
                        <!--                        </t>-->

                        <t t-foreach="list_month_val" t-as="lmv">
                            <table class="table table-sm table-bordered">
                                <thead>
                                    <tr align="center"
                                        style="font-size: 14px; color: white; background-color: #989898;">
                                        <td colspan="99">
                                            <span t-esc="lmv"/>
                                        </td>
                                    </tr>
                                    <tr align="center" style="background-color: #f2f2f2;">
                                        <td>Employee Name</td>
                                        <t t-foreach="present_absent[0]['list_month_dic'][lmv]['val']" t-as="jj">
                                            <td>
                                                <span t-esc="present_absent[0]['list_month_dic'][lmv]['val'][jj]['date']"/>
                                            </td>
                                        </t>
                                    </tr>
                                </thead>

                                <tbody>
                                    <t t-foreach="present_absent" t-as="val">
                                        <tr align="center">
                                            <td>
                                                <span t-esc="val['employee_name']"/>
                                            </td>

                                            <t t-foreach="val['list_month_dic'][lmv]['val']" t-as="jj">
                                                <t t-if="val['list_month_dic'][lmv]['val'][jj]['week_day'] != 6">
                                                    <t t-if="val['list_month_dic'][lmv]['val'][jj]['val']">
                                                        <t t-if="val['list_month_dic'][lmv]['val'][jj]['public_holidays'] == False">
                                                            <t t-if="val['list_month_dic'][lmv]['val'][jj]['half'] == False">
                                                                <t t-if="val['list_month_dic'][lmv]['val'][jj]['val'] == 'P'">
                                                                    <td style="background-color: #80ff80">
                                                                        <span t-esc="val['list_month_dic'][lmv]['val'][jj]['val']"/>
                                                                    </td>
                                                                </t>
                                                                <t t-else="">
                                                                    <td style="background-color: #99ccff">
                                                                        <span t-esc="val['list_month_dic'][lmv]['val'][jj]['val']"/>
                                                                    </td>
                                                                </t>
                                                            </t>
                                                            <t t-else="">
                                                                <td style="background-color: #ffb366">
                                                                    <span t-esc="val['list_month_dic'][lmv]['val'][jj]['val']"/>
                                                                    <br/>
                                                                    <span style="font-size: 10px"
                                                                          t-esc="val['list_month_dic'][lmv]['val'][jj]['half']"/>
                                                                </td>
                                                            </t>
                                                        </t>
                                                        <t t-else="">
                                                            <td style="background-color: #ffff80">
                                                                <span>PH</span>
                                                            </td>
                                                        </t>
                                                    </t>
                                                    <t t-else="">
                                                        <t t-if="val['list_month_dic'][lmv]['val'][jj]['public_holidays'] == True">
                                                            <td style="background-color: #ffff80">
                                                                <span>PH</span>
                                                            </td>
                                                        </t>
                                                        <t t-else="">
                                                            <td>
                                                                <span>-</span>
                                                            </td>
                                                        </t>
                                                    </t>
                                                </t>
                                                <t t-else="">
                                                    <td style="background-color: #ff704d">
                                                        <span>H</span>
                                                    </td>
                                                </t>
                                            </t>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>
                        <br/>
                        <br/>
                    </table>
                </t>

                <br/>
                <br/>
                <div align="center" class="px-3">
                    <h7 style="color: black; text-align:center; font-weight: bold; letter-spacing: 1px; ">
                        ******This is a Computer Generated Attendance Report. Signature Not Required******
                    </h7>
                </div>
            </t>
        </t>
    </template>
</odoo>